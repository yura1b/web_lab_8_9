const fs = require('fs');
const p = require('path');
const homedir = process.env.HOME || require('os').homedir();
const dbpath = p.join(homedir, '.node-todo-2');

const db = {
  read(path = dbpath) {
    return new Promise((resolve, reject) => {
      fs.readFile(path, {flag: 'a+'}, (error, data) => {
        if (error) return reject(error);
        const str = data.toString();
        str === '' ? resolve([]) : resolve(JSON.parse(str));
      });
    });
  },
  write(data,path=dbpath) {
    const str = JSON.stringify(data) + '\n';
    return new Promise((resolve, reject) => {
      fs.writeFile(path, str, (error) => {
        if (error) return reject(error);
        resolve()
      });
    });
  },

};

module.exports = db;